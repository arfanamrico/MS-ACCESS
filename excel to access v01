import os
import pyodbc
    
#====untuk mengetahui driver nya==========
#msa_drivers = [x for x in pyodbc.drivers() if 'ACCESS' in x.upper()]
#print(f'MS-Access drivers : {msa_drivers}')

#========cara connection ke mdb===========
dirpath = r"D:\Dokumen\DUMP\DUMP 3ID 20221017\DUMP 2G SMT"
try:
    con_string = r'DRIVER={Microsoft Access Driver (*.mdb, *.accdb)}; DBQ=D:\Dokumen\DUMP\DUMP 3ID 20221017\DUMP 2G SMT\2GDump.accdb;'
    conn = pyodbc.connect(con_string)
    print('connected to database')
except pyodbc.Error as e:
    print('error in connection', e)

cursor = conn.cursor()
#cursor.execute('CREATE TABLE T_BTS (BSCId string,	BCFId string,	BTSId string,	template_name string,	template_set string,	siteId string,	siteCId string,	adminState string,	allowIMSIAttachDetach string,	amhLowerLoadThreshold string,	amhMaxLoadOfTgtCell string,	amhTrhoGuardTime string,	amhUpperLoadThreshold string,	antennaHopping string,	applyRepeatedFacch string,	bcchTrxPower string,	beamHoppingThreshold string,	bsIdentityCodeBCC string,	bsIdentityCodeNCC string,	bscBscInterfaceStatus string,	btsIsHopping string,	btsLoadInSeg string,	btsLoadThreshold string,	btsMeasAver string,	callReestablishmentAllowed string,	carrierUnitConfiguration string,	cellBarQualify string,	cellBarred string,	cellId string,	cellLoadForChannelSearch string,	cellNumberInBtsHw string,	cellReselectHysteresis string,	cellReselectOffset string,	cellReselectParamInd string,	cnThreshold string,	compositedMultiSiteCell string,	dedicatedGPRScapacity string,	defaultGPRScapacity string,	dfcaMode string,	dfcaUnsyncModeMaList string,	diversityUsed string,	dlNoiseLevel string,	dldcEnabled string,	downgradeGuardTimeHSCSD string,	drInUse string,	drMethod string,	dtmEnabled string,	dtrxPowerDownThreshold string,	dtrxPowerUpThreshold string,	dtxMode string,	eUTRANMultiratReporting string,	eUTRANReportingOffset string,	eUTRANReportingThreshold string,	eUTRANReportingThreshold2 string,	earlySendingIndication string,	emergencyCallRestricted string,	enableTemporaryOverpower string,	extendedBcchEnabled string,	extendedPagingEnabled string,	facchBusyThreshold string,	fastReturnToLTE string,	fastReturnToTdScdma string,	fddQMin string,	fddQMinOffset string,	fddQOffset string,	fddRscpMin string,	forcedAmrHrCiThreshold string,	forcedHrCiAverPeriod string,	forcedHrCiThreshold string,	forcedHrModeHysteresis string,	freeTchLimit string,	frequencyBandInUse string,	gsmPriority string,	hcsPriorityClass string,	hcsThreshold string,	hoppingMode string,	hoppingSequenceNumber1 string,	hoppingSequenceNumber2 string,	hoppingSequenceNumber3 string,	ibhoGsmEnabled string,	ibhoWcdmaEnabled string,	idleStateBcchAllocListId string,	idrCellType string,	idrUsed string,	immediateSdcchHoEnabled string,	interferenceAveragingProcessAverPeriod string,	interferenceAveragingProcessBoundary0 string,	interferenceAveragingProcessBoundary1 string,	interferenceAveragingProcessBoundary2 string,	interferenceAveragingProcessBoundary3 string,	interferenceAveragingProcessBoundary4 string,	interferenceAveragingProcessBoundary5 string,	intervalMeasReportSending string,	limForTriggeringOscDfrMultiplexing string,	limForTriggeringOscDhrMultiplexing string,	locationAreaIdLAC string,	locationAreaIdMCC string,	locationAreaIdMNC string,	lowPriorityThr string,	lowerDlRxLevThrForBCCHTrxPref string,	lowerLimitCellLoadHSCSD string,	lteNCCREnabled string,	maioOffset string,	maioStep string,	masterBcf string,	maxGPRSCapacity string,	maxNumberOfRepetition string,	maxNumberRetransmission string,	maxQueueLength string,	maxTimeLimitDirectedRetry string,	measListUsedDuringMeas string,	measurementBCCHAllocation string,	mergedPgsmAndEgsmEnabled string,	minExhaustHSCSD string,	minHSCSDcapacityCell string,	minMsTxPower string,	minTimeLimitDirectedRetry string,	msMaxDistInCallSetup string,	msPriorityUsedInQueueing string,	msTxPwrMaxCCH string,	msTxPwrMaxCCH1x00 string,	msTxPwrMaxGSM string,	msTxPwrMaxGSM1x00 string,	mscHoCoEn string,	multiBandCell string,	multiBandCellReporting string,	nbrOfSlotsSpreadTrans string,	nbrTchForPrioritySubs string,	newEstabCausesSupport string,	noOfBlocksForAccessGrant string,	noOfMFramesBetweenPaging string,	nobAccessLowerDlRxLevelThreshold string,	nobAccessUpperDlRxLevelThreshold string,	nobDlPowerOffset string,	nobUlPowerOffset string,	nominalDlTxPower string,	nonBCCHLayerOffset string,	notificationOrigin string,	nsei string,	numberOfAdditionalRRHNodes string,	nwName string,	operatorPool string,	oscDfrRemultiplexingEnabled string,	oscDhrRemultiplexingEnabled string,	oscEdgeMixedUsage string,	pathLossOffsetDl string,	pathLossOffsetUl string,	pcuCsHopping string,	pcuCsNonHopping string,	pcuDlBlerCpHopping string,	pcuDlBlerCpNonHop string,	pcuDlLaRiskLevel string,	pcuIdentifier string,	pcuPswTbfDensityTarget string,	pcuPswTbfDowngradeThreshold string,	pcuPswTbfUpgradeThreshold string,	pcuUlBlerCpHopping string,	pcuUlBlerCpNonHop string,	pcuUlLaRiskLevel string,	pcuUpToDate string,	penaltyTime string,	powerOffset string,	precPagingUsage string,	preferBCCHfreqGPRS2 string,	priorityChUseIncomingHO string,	prioritySearchThr string,	psei string,	qSearchI string,	qSearchP string,	qSearchPEUTRAN string,	queuePriorityNonUrgentHo string,	queuePriorityUsed string,	queueingPriorityCall string,	queueingPriorityHandover string,	raReselectHysteresis string,	rac string,	rachBusyThreshold string,	rachDropRxLevelThreshold string,	radioLinkTimeout string,	radioLinkTimeoutAmrHrUlIncreaseStep string,	radioLinkTimeoutAmrUlIncreaseStep string,	radioLinkTimeoutUlIncreaseStep string,	radiusExtension string,	repeatedFacchInDl string,	repeatedFacchInUl string,	repeatedSacchInDl string,	repeatedSacchInUl string,	repeatedSacchRxLevThresholdDl string,	repeatedSacchRxLevThresholdUl string,	reselectionAlgorithmHysteresis string,	reservationMethod string,	rxLevAccessMin string,	rxSigLevAdjust string,	scaleOrd string,	sdcchMeasReportSending string,	sectorId string,	segmentId string,	segmentName string,	smsCbUsed string,	stircEnabled string,	superRadiusExtension string,	tdscdmaNccrEnabled string,	temporaryOffset string,	throughputFactor_cs1cs4dlcs string,	throughputFactor_cs1cs4ulcs string,	throughputFactor_mcs1mcs4ulcs string,	throughputFactor_mcs1mcs9dlcs string,	throughputFactor_mcs1mcs9ulcs string,	timeHysteresis string,	timeLimitCall string,	timeLimitHandover string,	timerPeriodicUpdateMs string,	transportType string,	trunkReservationUsed string,	trxPriorityInTchAlloc string,	txDiversityTimeShift string,	txSigLevAdjust string,	ulNoiseLevel string,	underlayHoppingMode string,	underlayMaAllocationId string,	underlayMaioOffset string,	underlayMaioStep string,	upgradeGainHSCSD string,	upgradeGuardTimeHSCSD string,	upperDlRxLevThrForBCCHTrxPref string,	upperLimitCellLoadHSCSD string,	upperLimitRegularLoadHSCSD string,	usedMobileAllocation string,	utranQualRxLevelMargin string,	utranThresholdReselection string,	wcdmaPriority string,	angle string,	cellType string,	insiteGateway string,	name string,	oldDN string,	siteTemplateDescription string,	siteTemplateName string,	status string,	last_modified string,	last_actual_import string)')
#cursor.commit()
def proses():
    cursor.execute(f"""select * into {nama} from 
                    [Excel 12.0 Xml; HDR=YES;IMEX=2;ACCDB=YES;DATABASE={dirpath}\{name}].[{nama}$]""")
    cursor.commit()
    print(f'table {nama} created')

for name in os.listdir(dirpath):
    path = os.path.join(dirpath, name)
    if path.endswith('.xlsx') and os.path.isfile(path):
        nama = name.split('.')[0]
        proses()
